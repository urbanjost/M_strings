#@(#) Makefile started by makeout(1) 2019-12-16 08:27:04
# generated by:   ...

NULL=
PROGFILES =  $(wildcard ../example/*.f90) $(wildcard ../example/*/*.F90)

TESTFILES = $(wildcard ../test/*.f90) $(wildcard ../test/*.F90) $(wildcard ../test/*/*.f) $(wildcard ../test/*/*.F)
TPROG = ${TESTFILES:.f90=}

CPROGFILES =

PROG1  = ${PROGFILES:.f90=}
PROG   = ${PROG1:.f90=}

CPROG = ${CPROGFILES:.c=}

SRCS =  M_strings.f90 M_strings__oop.f90

OBJS =  M_strings.o M_strings__oop.o
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# platform-specific values you will probably change
#
LIBS :=
CC := cc
CFLAGS := -O
FC := gfortran
F90FLAGS := -O -finit-local-zero

LDFLAGS :=
#
# You can either ignore it, or disable the "may be used uninitialized"
# warnings with -Wno-maybe-uninitialized or compile with optimizations
# (-O1 and more).
gfortran: F90=gfortran
gfortran: F90FLAGS := -g -O -Wall -std=f2018 -Wextra -Wno-maybe-uninitialized -Wno-uninitialized -finit-local-zero
gfortran: FFLAGS := -g -O -Wall -std=f2018 -Wextra -Wno-maybe-uninitialized -Wno-uninitialized -finit-local-zero
gfortran: all
	@echo built with $(F90)

nvfortran: F90=nvfortran
nvfortran: F90FLAGS := -Minform=inform -Mbackslash -traceback
nvfortran: all
	@echo built with $(F90)

ifort: F90=ifort
ifort: F90FLAGS := -warn all -traceback
ifort: all
	@echo built with $(F90)

nagfor: F90=nagfor
nagfor: F90FLAGS := -C all
nagfor: all
	@echo built with $(F90)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
all: $(PROG) $(CPROG) # $(TPROG)
	@echo "That's all folks!"
$(PROG): $(OBJS)

	-$(F90) $(F90FLAGS) $(LDFLAGS) $@.f90 -o $@ $(OBJS) $(LIBS) # && ./$@ </dev/null

#$(TPROG): $(OBJS)
#
#       -$(F90) $(LDFLAGS) $@.f90 -o $@ $(OBJS) $(LIBS) # && ./$@ </dev/null

.PHONY: clean
clean:
	rm -f $(PROG) $(CPROG) $(OBJS) *.mod $(TPROG)

.PHONY: help

help:
	: make    '-- build M_strings M_strings__oop module'
	: run     '-- run manpage demo programs and test program'
#	: test    '-- run test program (requires additional modules)'
	: man     '-- show all manpages as text'
	: ship    '-- rebuild archive files of manpages'
	: clean   '-- clean directory of object files and executables'
	: doxygen '-- run doxygen(1) if you have it'
	: help    '-- display this text'

.PHONY: ship
ship:
	: make easily distributed archive files of manpages
	mkdir -p ../docs; \
	 cd ../man/;    gzip */*.?m_strings; \
	 zip -r ../docs/manpages.zip   */*m_strings*.gz; \
	 tar cvfz ../docs/manpages.tgz */*m_strings*.gz; \
	 gunzip */*.?m_strings.gz

.PHONY: run
run: $(PROG)
	# run everything
	echo $? | xargs -n 1
#	echo $? | xargs -n 1  |xargs -iXX /bin/time XX  \</dev/null
	echo $? | xargs -n 1  |(set +x;xargs -iXX env XX 2>&1)

#.PHONY: test
#test: $(TPROG)
#	# run everything
#	echo $? | xargs -n 1
#	echo $? | xargs -n 1  |(set +x;xargs -iXX env XX 2>&1)

.PHONY: doxygen
doxygen:
	doxygen dox.in

.PHONY: man
man:
	@mandb ../man 1>&2
	@env MANPATH=../man MANWIDTH=256 man -k .|col -b
	@env MANPATH=../man MANWIDTH=80  man -Tutf8 --regex '.*'|col -b

.SUFFIXES: $(SUFFIXES) .f90 .F90

.f90.o:
	$(F90) $(F90FLAGS) -c $<

.F90.o:
	$(F90) $(F90FLAGS) -c $<

M_strings__oop.o: M_strings.o
